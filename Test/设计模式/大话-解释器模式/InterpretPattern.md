#  解释器模式（Interpreter Pattern）

## 1. 定义
解释器模式（Interpreter Pattern）是一种 行为型设计模式，

它为一种语言定义文法表示，并且提供一个解释器来解释语言中的句子。

简单说就是：当你需要设计一种“语言”或“表达式语法”时，可以用解释器模式来描述和解析。

这种模式常用于：数学表达式、规则引擎、SQL 解析、配置脚本等场景。

核心思想是定义一个语言的语法规则，并设计一个 “解释器” 来解析和执行该语言中的句子（即符合语法规则的表达式）。

它本质上是将特定问题的解决方案，转化为一套可被机器理解和执行的 “迷你语言”，通过解释器逐句解析并执行该语言的逻辑。

## 2. 核心概念与结构

为了实现 “定义语法 + 解析执行” 的目标，解释器模式通常包含以下 6 个核心角色，各角色职责明确且协同工作：
主要角色：
1. AbstractExpression（抽象表达式）：定义解释操作的接口。

2. TerminalExpression（终结符表达式）：表示文法中的基本元素，不能再分解。

3. NonTerminalExpression（非终结符表达式）：表示文法规则，通常由多个表达式组合而成。

4. Context（上下文）：存放解释器之外的一些全局信息。

5. Client（客户端）：构建语法树，然后调用解释操作。

## 3. 优点
✅ 可扩展性强：修改文法规则或新增表达式很方便。
✅ 易于实现简单语言：可以快速实现一套小型的语法解释器。
✅ 语法清晰：语法规则直接对应代码结构。

## 4. 缺点

❌ 性能较低：如果文法复杂，语法树会很大，解释效率低。
❌ 难以维护：表达式类很多时，系统会变得复杂且难以管理。
❌ 只适合简单文法：对于复杂语言（比如编程语言编译器），更适合用 语法分析器/编译器技术（如 ANTLR、Lex/Yacc）。

5. 适用场景
解释器模式并非通用模式，仅适用于特定场景，核心判断标准是 “问题可转化为简单、固定语法的迷你语言”：

1. 简单语法的 “迷你语言” 解析
* 当问题需要定义一套简单的自定义语言（或规则），且需机器解析执行时，例如：
* 配置文件解析：自定义配置语法（如timeout=30s; logLevel=INFO），解释器解析配置项并加载到系统中。
* 公式计算：简单数学公式（如 Excel 中的SUM(A1:A10)、工程中的F=ma），解释器计算结果。
* 规则引擎：业务规则表达式（如 “会员等级>=VIP3 且 消费金额 > 1000 → 享受 9 折优惠”），解释器判断规则是否生效。

2. 语法规则固定且少变更
若语法规则频繁迭代（如频繁新增运算符、修改优先级），会导致表达式类爆炸，此时不适合使用解释器模式。例如：
* 不适合实现编程语言的编译器（语法复杂且多变，需专业工具如 ANTLR、YACC）；
* 适合实现固定格式的报表计算公式（语法长期不变，仅需解析少量运算符）。

3. 重复执行的表达式解析
若同一类表达式需要被反复解析执行，解释器模式可通过 “预构建抽象语法树” 减少重复解析成本。例如：
监控系统中，对 “CPU 使用率> 80% 且 内存使用率 > 90%” 的告警规则，解释器可预构建 AST，每次只需传入实时数据（上下文）即可快速判断。

应用场景与替代方案:

1. 典型应用场景
* SQL 解析：数据库中对 SQL 语句的语法解析（简化版，复杂 SQL 需专用解析器）。
* 正则表达式：正则引擎本质是解释器，解析正则语法并匹配字符串。
* 模板引擎：如 FreeMarker、Thymeleaf，解析模板语法（如${variable}）并渲染页面。

2. 不适用场景的替代方案
* 当语法复杂或效率要求高时，建议替代方案：
使用专用解析工具：如 ANTLR（生成语法解析器）、YACC（编译器前端工具），替代手动实现解释器模式，降低代码复杂度。
使用表达式引擎：如 Java 的MVEL、SpEL（Spring 表达式语言），已封装复杂表达式解析逻辑，无需重复造轮子。
* 状态模式 / 策略模式：若仅需处理简单条件判断（而非语法解析），可使用状态模式（按状态分支）或策略模式（按算法分支），效率更高。
## 总结

解释器模式的核心价值在于将 “特定规则” 转化为 “可执行的迷你语言”，适用于语法简单、固定且需灵活扩展的场景。但需注意其效率瓶颈 —— 复杂语法下会导致代码膨胀和性能下降，此时应优先选择专用解析工具或成熟的表达式引擎，而非手动实现。

## OC 框架中的应用：
1. NSRegularExpression， 正则表达式引擎本质是解释器 —— 将正则语法（如 \d+、[a-z]）解析为状态机，再匹配字符串。
2. NSPredicate：用于过滤集合的谓词语法， 如 （age > 18 AND name CONTAINS 'John'），内部通过解释器解析谓词字符串并执行过滤逻辑


