## 策略模式（Strategy Pattern）是什么？

策略模式是一种行为设计模式，
它的核心思想是：定义一系列算法，将每个算法封装起来，使它们可以相互替换。

这样可以让算法的变化独立于使用算法的客户端，从而实现灵活的功能切换。

简单来说，策略模式解决的是 “做同一件事有多种不同方式，需要灵活选择” 的问题。

## 核心组成
1. 环境类（Context）：持有策略对象的引用，负责调用具体策略执行操作
2. 抽象策略接口（Strategy）：定义所有具体策略类需要实现的方法
3. 具体策略类（Concrete Strategy）：实现抽象策略接口，包含具体的算法实现

## 优点
1. 灵活性高：可以动态切换不同的算法或行为，无需修改原有代码
2. 扩展性好：新增策略只需实现接口，不影响现有代码，符合开闭原则
3. 代码复用：将算法封装在独立类中，避免重复代码
4. 降低耦合：客户端无需知道具体算法细节，只需关注如何使用
5. 便于测试：每个策略独立，可单独进行单元测试

## 缺点
1. 增加类数量：每个策略都需要一个类，可能导致类数量增多
2. 客户端需了解策略：客户端需要知道所有策略的存在才能选择合适的策略
3. 策略切换成本：频繁切换策略可能带来额外的性能开销
4. 策略间通信困难：不同策略之间难以共享数据

## 适合解决的场景
1. 存在多种相似算法：如排序算法、加密算法等多种实现方式
2. 需要动态切换算法：如根据不同条件使用不同的计算方式
3. 算法需要被频繁替换：如电商平台的促销策略（满减、折扣、赠品等）
4. 避免多重条件判断：用策略模式替代复杂的 if-else 或 switch-case 语句
5. 算法需要独立于使用它的客户端：如不同支付方式的实现
* 典型应用案例
* 电商平台的多种促销活动计算
* 导航软件的不同路线规划算法
* 图片处理软件的多种滤镜效果
* 游戏中角色的不同攻击方式
* 数据验证的多种验证规则

**策略模式特别适合在需要灵活选择不同行为的场景中使用，能够有效提升代码的可维护性和扩展性。**

例如：
1. 支付系统（支付宝、微信、银联等不同支付方式）
2. 排序算法（冒泡、快速、归并等不同排序策略）
3. 出行方式（步行、骑车、开车等不同路线策略）
4. OC 中  NSSortDescriptor（排序策略）、UIAnimation（动画策略）等，本质都是通过协议 / 接口定义抽象策略，再提供不同实现


**策略模式就是用来封装算法的，但在实践中，我们发现可用来封装几乎任何类型的的规则，
只要在分析过程中听到需要在不同时间应用不同的业务规则，就可以考虑使用策略模式处理这种变化的可能性**。

# 在iOS 中的应用：

### iOS 系统框架中的策略模式应用
1. 苹果官方框架中大量使用了策略模式的思想：

UIKit 布局系统：
* UIViewContentMode 定义了视图内容的缩放和对齐策略（如 .scaleAspectFit、.center 等）
* UICollectionViewLayout 及其子类（如 UICollectionViewFlowLayout）允许为集合视图设置不同的布局策略

2. 排序与筛选：
* NSSortDescriptor 封装了数组排序的策略，可通过不同的 key、ascending 参数定义排序规则
* NSPredicate 提供了数据筛选的策略，通过不同表达式实现灵活过滤

3. 动画系统：
* UIView.AnimationOptions 定义了动画执行的各种策略（如曲线、重复方式等）
* CAAnimation 子类（如 CABasicAnimation、CAKeyframeAnimation）提供不同动画实现策略


代码解析

1. 抽象策略协议（PaymentStrategy）：
* 定义了所有支付策略必须实现的接口 payWithAmount:
* 所有具体支付方式都需要遵守这个协议

2. 具体策略实现：
* AlipayStrategy：支付宝支付实现
* WechatPayStrategy：微信支付实现
* UnionPayStrategy：银联支付实现
* 每个策略独立实现自己的支付逻辑，相互之间没有耦合

3. 环境类（PaymentContext）：
* 持有一个策略对象，负责与策略对象交互
* 提供 setStrategy: 方法允许在运行时动态切换策略
* 通过 executePaymentWithAmount: 方法调用当前策略的支付功能

4. 客户端使用：
* 客户端只需与环境类交互，无需直接操作具体策略
* 可以随时切换不同的支付策略，而不需要修改支付逻辑

这种实现方式的优势在于：当需要添加新的支付方式（如 Apple Pay）时，只需新增一个遵守PaymentStrategy协议的类，无需修改现有代码，完全符合开闭原则。同时，客户端可以根据用户选择或业务需求灵活切换支付方式。
