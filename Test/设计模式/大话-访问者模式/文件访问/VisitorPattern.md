#  访问者模式（Visitor Pattern）

访问者模式（Visitor Pattern） 是一种行为型设计模式。

它的核心思想是：**将作用于某种数据结构（如对象结构）中的各元素的操作分离出来，封装成独立的访问者对象。这样在不改变数据结构的前提下，可以定义作用于这些元素的新操作**。

换句话说：
* 数据结构（元素对象）相对稳定。
* 数据结构上的操作（行为）可能经常变化。
* 通过访问者模式，把“数据结构”和“操作”解耦。

经典定义：表示一个作用于某对象结构中的各元素的操作。它使你可以在不改变元素类的前提下，定义作用于这些元素的新操作。

## 核心结构
1. 访问者（Visitor）：定义对每个元素的访问操作接口
2. 具体访问者（Concrete Visitor）：实现访问者接口，定义具体操作
3. 元素（Element）：定义接受访问者的接口（accept() 方法）
4. 具体元素（Concrete Element）：实现元素接口，通过 accept() 方法接收访问者
5. 对象结构（Object Structure）：存储元素集合，提供遍历元素的方法

## 优缺点

优点：

1. 扩展性好：增加新的访问者（即新的操作）非常方便，不需要改动数据结构。
2. 解耦：将数据结构与操作分离，职责单一。
3. 灵活性：能够在不改变元素类的情况下，为其增加多种不同的操作。

缺点：

1. 破坏封装性：访问者需要访问元素内部状态，可能暴露私有数据
2. 元素类变更困难：若元素类增加新方法或属性，可能需要修改所有访问者
3. 依赖关系复杂：访问者与元素类之间可能形成紧密耦合
4. 学习成本较高：理解和正确应用访问者模式需要一定的设计经验

## 适合解决的问题, 访问者模式适用于：

1. 数据结构稳定，但操作经常变化的场景。
比如：编译器中，语法树结构相对稳定，但不同的操作（语法检查、代码优化、代码生成）会经常扩展。

2. 需要对不同种类的元素做不同操作，但不想在元素类中堆积太多逻辑。

3. 希望将“对象结构”和“操作”解耦的场景。

## 典型应用场景
1. 编译器的语法分析和代码生成
2. 文档解析器（如 XML/HTML 解析）
3. 复杂集合的批量处理和转换
4. 报表生成系统
5. 抽象语法树（AST）的各种分析操作

访问者模式特别适合在维护遗留系统时使用，当你需要添加新功能但又不想修改现有代码结构时，它能提供很好的解决方案。

✅ 总结一句话：
**访问者模式适合在 对象结构稳定，但要频繁添加新功能 的场景中使用**。

Code 解析
## 这个 Objective-C 实现的文件系统访问者模式包含以下核心组件：

1. 元素接口：File协议，定义了accept:方法，所有文件类型都要实现
2. 具体元素：TextFile和ImageFile类，分别表示文本文件和图片文件
3. 访问者接口：Visitor协议，定义了访问不同文件类型的方法
4. 具体访问者：
* SizeVisitor：统计文件总大小
* InfoVisitor：打印文件详细信息
5. 对象结构：FileManager类，管理文件集合并提供统一访问入口
